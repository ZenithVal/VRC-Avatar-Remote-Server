(function(){var t={18339:function(t,e,a){"use strict";var n=a(49242),o=a(73396),r=a(87139);const i={key:0},s=(0,o._)("h1",null,"This page could not be found",-1),l=[s],d={key:0},u=(0,o._)("h1",null,"Loading...",-1),c=[u],h={key:1},p={key:0},g={class:"text"},v=(0,o.Uk)("Avatar: "),w={class:"controls"},f=["onClick"],m={class:"title-wrapper"},b={class:"title"},_=["onClick"],y={class:"title-wrapper"},k={class:"title"},I=(0,o._)("div",{class:"slider-wrapper"},[(0,o._)("div",{class:"slider"})],-1),V={key:2,class:"control control-range"},M={class:"title-wrapper"},P={class:"title"};function T(t,e,a,n,s,u){const T=(0,o.up)("Login"),D=(0,o.up)("RadialMenu");return(0,o.wg)(),(0,o.iD)("main",null,[t.notFound?((0,o.wg)(),(0,o.iD)("div",i,l)):(0,o.kq)("",!0),t.loggedIn||t.notFound?(0,o.kq)("",!0):((0,o.wg)(),(0,o.j4)(T,{key:1,onAttemptLogin:e[0]||(e[0]=e=>t.performLogin(u.boardId,e)),errorMessage:t.loginError},null,8,["errorMessage"])),t.loggedIn&&!t.notFound?((0,o.wg)(),(0,o.iD)(o.HY,{key:2},[null===s.board?((0,o.wg)(),(0,o.iD)("div",d,c)):((0,o.wg)(),(0,o.iD)("div",h,[(0,o._)("h1",null,(0,r.zw)(s.board.name),1),null===s.avatarId?((0,o.wg)(),(0,o.iD)("h2",p,"The currently selected avatar has no controls on this board")):(0,o.kq)("",!0),null!==u.currentAvatar?((0,o.wg)(),(0,o.iD)(o.HY,{key:1},[(0,o._)("div",g,[v,(0,o._)("b",null,(0,r.zw)(u.currentAvatar.name),1)]),(0,o._)("div",w,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(s.controls,((t,e)=>((0,o.wg)(),(0,o.iD)("div",{key:e,class:"control-wrapper"},["button"===t.types.control?((0,o.wg)(),(0,o.iD)("div",{key:0,class:(0,r.C_)(["control control-button",{clicked:t.clicked}]),onClick:e=>u.performAction(t)},[(0,o._)("div",m,[(0,o._)("div",b,(0,r.zw)(t.label),1)])],10,f)):"toggle"===t.types.control?((0,o.wg)(),(0,o.iD)("div",{key:1,class:(0,r.C_)(["control control-toggle",{toggled:t.isToggled(s.avatarParameterValues)}]),onClick:e=>u.performAction(t)},[(0,o._)("div",y,[(0,o._)("div",k,(0,r.zw)(t.label),1)]),I],10,_)):"range"===t.types.control?((0,o.wg)(),(0,o.iD)("div",V,[(0,o._)("div",M,[(0,o._)("div",P,(0,r.zw)(t.label),1)]),(0,o.Wm)(D,{style:{width:"100%",height:"100%"},modelValue:s.avatarParameterValues[t.name],"onUpdate:modelValue":[e=>s.avatarParameterValues[t.name]=e,e=>u.setParamValue(t,e)]},null,8,["modelValue","onUpdate:modelValue"])])):(0,o.kq)("",!0)])))),128))])],64)):(0,o.kq)("",!0)]))],64)):(0,o.kq)("",!0)])}var D=a(56265),$=a.n(D),L=a(43959),x={data(){return{loggedIn:!1,notFound:!1,loginError:null}},methods:{async checkLogin(t){try{const e=await $().get(`/api/login/${t}`);this.loggedIn=e.data.loggedIn}catch(e){404==e.response.status&&(this.notFound=!0)}},async performLogin(t,e){this.loginError=null;try{const a=await $().post(`/api/login/${t}`,{password:e});this.loggedIn=this.loggedIn||a.data.success,a.data.success||(this.loginError="Login failed (Wrong password)")}catch(a){console.log(a.response)}},getPasswordParam(){const t=new URLSearchParams(window.location.search);return t.get("password")}}},E=(a(21703),a(78830));class O extends E.H{constructor(t,e){super(t),this._avatarId=e,this._clicked=!1}clone(){return new O(this.serialize(),this._avatarId)}get clicked(){return this._clicked}async setValue(t,e){await new Promise(((a,n)=>{t.emit("set-parameter",{avatar:this._avatarId,controlId:this.id,value:e},(t=>t.success?a():n(new Error(t.error))))}))}async performAction(t){this._clicked=!0,await new Promise(((e,a)=>{t.emit("perform-action",{avatar:this._avatarId,controlId:this.id},(t=>(this._clicked=!1,t.success?e():a(new Error(t.error)))))}))}isToggled(t){return this.name in t&&t[this.name]==this._setValue}}const S=t=>((0,o.dD)("data-v-902ad498"),t=t(),(0,o.Cn)(),t),z={class:"basic-box login-box"},A=S((()=>(0,o._)("h1",null,"Login",-1))),C={key:0,class:"error"},j=S((()=>(0,o._)("button",{class:"button green small login-button"},"Login",-1)));function F(t,e,a,i,s,l){return(0,o.wg)(),(0,o.iD)("div",z,[A,(0,o._)("form",{onSubmit:e[1]||(e[1]=(0,n.iM)((e=>t.$emit("attempt-login",s.password)),["prevent"]))},[(0,o.wy)((0,o._)("input",{type:"password","onUpdate:modelValue":e[0]||(e[0]=t=>s.password=t),class:"password-input",placeholder:"Password"},null,512),[[n.nr,s.password]]),null!=a.errorMessage?((0,o.wg)(),(0,o.iD)("div",C,(0,r.zw)(a.errorMessage),1)):(0,o.kq)("",!0),j],32)])}var R={name:"LoginComponent",props:["errorMessage"],data(){return{password:""}}},q=a(40089);const H=(0,q.Z)(R,[["render",F],["__scopeId","data-v-902ad498"]]);var W=H;const B={class:"radial-menu",ref:"container"},Y=["width","height"];function N(t,e,a,n,r,i){return(0,o.wg)(),(0,o.iD)("div",B,[(0,o._)("canvas",{ref:"canvas",width:r.canvasWidth,height:r.canvasHeight,onMousedown:e[0]||(e[0]=(...t)=>i.handleMousedown&&i.handleMousedown(...t)),onMousemove:e[1]||(e[1]=(...t)=>i.handleMousemove&&i.handleMousemove(...t))},null,40,Y)],512)}var U=a(4852),Z=a.n(U),X={name:"RadialMenu",props:["modelValue"],data(){return{canvasWidth:100,canvasHeight:100,mouseDown:!1,inputValue:void 0!==this.modelValue?this.modelValue:0}},computed:{},watch:{modelValue(t){this.mouseDown||void 0===t||(this.inputValue=t,this.render())}},methods:{resize(){if(null==this.$refs.container)return;const t=this.$refs.container.getBoundingClientRect();this.canvasWidth=Math.floor(t.width*window.devicePixelRatio),this.canvasHeight=Math.floor(t.height*window.devicePixelRatio),(0,o.Y3)((()=>{this.render()}))},render(){const t=this.$refs.canvas,e=t.width,a=t.height,n=Math.min(e,a)/6,o=t.getContext("2d");o.clearRect(0,0,e,a);const r=Z()(["#6B0F12","#009432"]);o.lineWidth=n,o.strokeStyle=r(this.inputValue);const i=Math.min(e,a)/2-Math.min(e,a)/10-n/2;o.beginPath(),o.arc(e/2,a/2,i,0,2*Math.PI),o.stroke();const s=e/2+Math.sin(-this.inputValue*Math.PI*2)*i,l=a/2+Math.cos(this.inputValue*Math.PI*2)*i;o.fillStyle="#343434",o.strokeStyle="#676767",o.lineWidth=3,o.beginPath(),o.arc(s,l,n/3*2,0,2*Math.PI),o.fill(),o.stroke(),o.font=i/3+"px Arial",o.fillStyle="white",o.textAlign="center",o.textBaseline="middle",o.fillText(`${Math.round(100*this.inputValue)}`,s,l+3)},handleMousedown(t){window.addEventListener("mouseup",this.handleMouseup),this.mouseDown=!0,this.handleMouse(t.offsetX,t.offsetY)},handleMousemove(t){this.mouseDown&&this.handleMouse(t.offsetX,t.offsetY)},handleMouseup(t){this.mouseDown=!1},handleMouse(t,e){const a=this.$refs.canvas,n=a.width,o=a.height;let r=-Math.atan2(t-n/2,e-o/2);r=r<0?r+2*Math.PI:r,this.inputValue=r/(2*Math.PI),this.$emit("update:modelValue",this.inputValue),this.render()}},mounted(){this.resize(),new ResizeObserver(this.resize).observe(this.$refs.container)}};const K=(0,q.Z)(X,[["render",N],["__scopeId","data-v-da81a1c6"]]);var G=K,J={mixins:[x],components:{Login:W,RadialMenu:G},data(){return{board:null,avatarId:null,avatarParameterValues:{},controls:{}}},computed:{boardId(){const t=window.location.pathname.match(/^\/b\/((?:\w|-)+)/);return null==t?null:t[1]},currentAvatar(){return null==this.board||null==this.avatarId?null:this.board.avatars[this.avatarId]}},watch:{async loggedIn(){this.loggedIn&&(await this.updateBoard(),this.setupSocket())}},methods:{async updateBoard(){if(!this.loggedIn)return;const t=await $().get(`/api/b/${this.boardId}/full`);this.board=t.data.board},setupSocket(){null!=this.boardId&&this.loggedIn&&(this.$options.socket=(0,L.io)({query:{target:this.boardId},reconnection:!0}),this.$options.socket.on("avatar",(t=>{if(this.avatarId=null!==t?t.id:null,this.avatarParameterValues={},this.controls={},null!==this.avatarId)for(let e in this.board.avatars[this.avatarId].controls)this.controls[e]=new O(this.board.avatars[this.avatarId].controls[e],this.avatarId)})),this.$options.socket.on("parameter",(t=>{this.avatarParameterValues[t.name]=t.value})))},performAction(t){t.performAction(this.$options.socket).catch((t=>{console.error(t)}))},setParamValue(t,e){t.setValue(this.$options.socket,e).catch((t=>{console.error(t)}))}},async created(){if(this.$options.socket=null,null!==this.boardId){await this.checkLogin(this.boardId);const t=this.getPasswordParam();this.loggedIn||null===t||await this.performLogin(this.boardId,t),await this.updateBoard(),this.setupSocket()}else this.notFound=!0}};const Q=(0,q.Z)(J,[["render",T]]);var tt=Q;(0,n.ri)(tt).mount("#app")},78830:function(t,e,a){a(21703);class n{constructor(t){if(this._id=t.id,this._name=t.name,this._icon=t.icon,this._label=t.label,this._dataType=t.dataType,!["bool","int","float"].includes(this._dataType))throw new Error(`Invalid data type ${this._dataType}`);if(this._controlType=t.controlType,!["button","toggle","range"].includes(this._controlType))throw new Error(`Invalid data type ${this._dataType}`);if(this._setValue=t.setValue,!this.isValueLegal(this._setValue))throw new Error("Invalid set value");if(this._defaultValue=t.defaultValue,!this.isValueLegal(this._defaultValue))throw new Error("Invalid default value");null===this._label&&(this._label=`${this._controlType} ${this._name}`)}get id(){return this._id}get name(){return this._name}get label(){return this._label}get types(){return{data:this._dataType,control:this._controlType}}serialize(){return{id:this._id,name:this._name,label:this._label,icon:this._icon,dataType:this._dataType,controlType:this._controlType,setValue:this._setValue,defaultValue:this._defaultValue}}clone(){return new n(this.serialize())}isValueLegal(t){switch(this._dataType){case"bool":return"boolean"===typeof t;case"int":return Number.isInteger(t)&&t>=0&&t<=255;case"float":return Number.isFinite(t)&&t>=-1&&t<=1;default:return!1}}async performAction(){throw new Error("Not implemented")}async setValue(){throw new Error("Not implemented")}isToggled(){throw new Error("Not implemented")}}e.H=n}},e={};function a(n){var o=e[n];if(void 0!==o)return o.exports;var r=e[n]={exports:{}};return t[n](r,r.exports,a),r.exports}a.m=t,function(){var t=[];a.O=function(e,n,o,r){if(!n){var i=1/0;for(u=0;u<t.length;u++){n=t[u][0],o=t[u][1],r=t[u][2];for(var s=!0,l=0;l<n.length;l++)(!1&r||i>=r)&&Object.keys(a.O).every((function(t){return a.O[t](n[l])}))?n.splice(l--,1):(s=!1,r<i&&(i=r));if(s){t.splice(u--,1);var d=o();void 0!==d&&(e=d)}}return e}r=r||0;for(var u=t.length;u>0&&t[u-1][2]>r;u--)t[u]=t[u-1];t[u]=[n,o,r]}}(),function(){a.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return a.d(e,{a:e}),e}}(),function(){a.d=function(t,e){for(var n in e)a.o(e,n)&&!a.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})}}(),function(){a.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){a.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}}(),function(){a.j=826}(),function(){var t={826:0};a.O.j=function(e){return 0===t[e]};var e=function(e,n){var o,r,i=n[0],s=n[1],l=n[2],d=0;if(i.some((function(e){return 0!==t[e]}))){for(o in s)a.o(s,o)&&(a.m[o]=s[o]);if(l)var u=l(a)}for(e&&e(n);d<i.length;d++)r=i[d],a.o(t,r)&&t[r]&&t[r][0](),t[r]=0;return a.O(u)},n=self["webpackChunkclient"]=self["webpackChunkclient"]||[];n.forEach(e.bind(null,0)),n.push=e.bind(null,n.push.bind(n))}();var n=a.O(void 0,[998],(function(){return a(18339)}));n=a.O(n)})();
//# sourceMappingURL=index.8d53bb76.js.map